var ye=Object.defineProperty,ve=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var Y=(n,e,t)=>e in n?ye(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,X=(n,e)=>{for(var t in e||(e={}))Ce.call(e,t)&&Y(n,t,e[t]);if(K)for(var t of K(e))we.call(e,t)&&Y(n,t,e[t]);return n},G=(n,e)=>ve(n,be(e));var h=(n,e,t)=>new Promise((s,i)=>{var o=c=>{try{a(t.next(c))}catch(d){i(d)}},r=c=>{try{a(t.throw(c))}catch(d){i(d)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(o,r);a((t=t.apply(n,e)).next())});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const C=Object.create(null);C.open="0";C.close="1";C.ping="2";C.pong="3";C.message="4";C.upgrade="5";C.noop="6";const T=Object.create(null);Object.keys(C).forEach(n=>{T[C[n]]=n});const N={type:"error",data:"parser error"},ne=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",oe=typeof ArrayBuffer=="function",re=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,$=({type:n,data:e},t,s)=>ne&&e instanceof Blob?t?s(e):Q(e,s):oe&&(e instanceof ArrayBuffer||re(e))?t?s(e):Q(new Blob([e]),s):s(C[n]+(e||"")),Q=(n,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(n)};function Z(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let M;function ke(n,e){if(ne&&n.data instanceof Blob)return n.data.arrayBuffer().then(Z).then(e);if(oe&&(n.data instanceof ArrayBuffer||re(n.data)))return e(Z(n.data));$(n,!1,t=>{M||(M=new TextEncoder),e(M.encode(t))})}const ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<ee.length;n++)_[ee.charCodeAt(n)]=n;const Ee=n=>{let e=n.length*.75,t=n.length,s,i=0,o,r,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const d=new ArrayBuffer(e),u=new Uint8Array(d);for(s=0;s<t;s+=4)o=_[n.charCodeAt(s)],r=_[n.charCodeAt(s+1)],a=_[n.charCodeAt(s+2)],c=_[n.charCodeAt(s+3)],u[i++]=o<<2|r>>4,u[i++]=(r&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return d},_e=typeof ArrayBuffer=="function",z=(n,e)=>{if(typeof n!="string")return{type:"message",data:ae(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:Se(n.substring(1),e)}:T[t]?n.length>1?{type:T[t],data:n.substring(1)}:{type:T[t]}:N},Se=(n,e)=>{if(_e){const t=Ee(n);return ae(t,e)}else return{base64:!0,data:n}},ae=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},ce="",Re=(n,e)=>{const t=n.length,s=new Array(t);let i=0;n.forEach((o,r)=>{$(o,!1,a=>{s[r]=a,++i===t&&e(s.join(ce))})})},xe=(n,e)=>{const t=n.split(ce),s=[];for(let i=0;i<t.length;i++){const o=z(t[i],e);if(s.push(o),o.type==="error")break}return s};function Te(){return new TransformStream({transform(n,e){ke(n,t=>{const s=t.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,s)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(s))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let O;function S(n){return n.reduce((e,t)=>e+t.length,0)}function R(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let s=0;for(let i=0;i<e;i++)t[i]=n[0][s++],s===n[0].length&&(n.shift(),s=0);return n.length&&s<n[0].length&&(n[0]=n[0].slice(s)),t}function Le(n,e){O||(O=new TextDecoder);const t=[];let s=0,i=-1,o=!1;return new TransformStream({transform(r,a){for(t.push(r);;){if(s===0){if(S(t)<1)break;const c=R(t,1);o=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(S(t)<2)break;const c=R(t,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(S(t)<8)break;const c=R(t,8),d=new DataView(c.buffer,c.byteOffset,c.length),u=d.getUint32(0);if(u>Math.pow(2,21)-1){a.enqueue(N);break}i=u*Math.pow(2,32)+d.getUint32(4),s=3}else{if(S(t)<i)break;const c=R(t,i);a.enqueue(z(o?c:O.decode(c),e)),s=0}if(i===0||i>n){a.enqueue(N);break}}}})}const le=4;function f(n){if(n)return Be(n)}function Be(n){for(var e in f.prototype)n[e]=f.prototype[e];return n}f.prototype.on=f.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};f.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};f.prototype.off=f.prototype.removeListener=f.prototype.removeAllListeners=f.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,i=0;i<t.length;i++)if(s=t[i],s===e||s.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};f.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,i=t.length;s<i;++s)t[s].apply(this,e)}return this};f.prototype.emitReserved=f.prototype.emit;f.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};f.prototype.hasListeners=function(n){return!!this.listeners(n).length};const I=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),g=typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")(),Ae="arraybuffer";function de(n,...e){return e.reduce((t,s)=>(n.hasOwnProperty(s)&&(t[s]=n[s]),t),{})}const Ie=g.setTimeout,Pe=g.clearTimeout;function P(n,e){e.useNativeTimers?(n.setTimeoutFn=Ie.bind(g),n.clearTimeoutFn=Pe.bind(g)):(n.setTimeoutFn=g.setTimeout.bind(g),n.clearTimeoutFn=g.clearTimeout.bind(g))}const Me=1.33;function Oe(n){return typeof n=="string"?qe(n):Math.ceil((n.byteLength||n.size)*Me)}function qe(n){let e=0,t=0;for(let s=0,i=n.length;s<i;s++)e=n.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function he(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Ne(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function Fe(n){let e={},t=n.split("&");for(let s=0,i=t.length;s<i;s++){let o=t[s].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class Ue extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class D extends f{constructor(e){super(),this.writable=!1,P(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new Ue(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=z(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Ne(e);return t.length?"?"+t:""}}class Ve extends D{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};xe(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Re(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=he()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let ue=!1;try{ue=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const He=ue;function je(){}class $e extends Ve{constructor(e){if(super(e),typeof location!="undefined"){const t=location.protocol==="https:";let s=location.port;s||(s=t?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}class b extends f{constructor(e,t,s){super(),this.createRequest=e,P(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const t=de(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch(i){}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{s.setRequestHeader("Accept","*/*")}catch(i){}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document!="undefined"&&(this._index=b.requestsCount++,b.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr=="undefined"||this._xhr===null)){if(this._xhr.onreadystatechange=je,e)try{this._xhr.abort()}catch(t){}typeof document!="undefined"&&delete b.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}b.requestsCount=0;b.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",te);else if(typeof addEventListener=="function"){const n="onpagehide"in g?"pagehide":"unload";addEventListener(n,te,!1)}}function te(){for(let n in b.requests)b.requests.hasOwnProperty(n)&&b.requests[n].abort()}const ze=function(){const n=pe({xdomain:!1});return n&&n.responseType!==null}();class De extends $e{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=ze&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new b(pe,this.uri(),e)}}function pe(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||He))return new XMLHttpRequest}catch(t){}if(!e)try{return new g[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}const fe=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Je extends D{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=fe?{}:de(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;$(s,this.supportsBinary,o=>{try{this.doWrite(s,o)}catch(r){}i&&I(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=he()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const q=g.WebSocket||g.MozWebSocket;class We extends Je{createSocket(e,t,s){return fe?new q(e,t,s):t?new q(e,t):new q(e)}doWrite(e,t){this.ws.send(t)}}class Ke extends D{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Le(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),i=Te();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const o=()=>{s.read().then(({done:a,value:c})=>{a||(this.onPacket(c),o())}).catch(a=>{})};o();const r={type:"open"};this.query.sid&&(r.data=`{"sid":"${this.query.sid}"}`),this._writer.write(r).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;this._writer.write(s).then(()=>{i&&I(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Ye={websocket:We,webtransport:Ke,polling:De},Xe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ge=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function F(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),s=n.indexOf("]");t!=-1&&s!=-1&&(n=n.substring(0,t)+n.substring(t,s).replace(/:/g,";")+n.substring(s,n.length));let i=Xe.exec(n||""),o={},r=14;for(;r--;)o[Ge[r]]=i[r]||"";return t!=-1&&s!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Qe(o,o.path),o.queryKey=Ze(o,o.query),o}function Qe(n,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function Ze(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,o){i&&(t[i]=o)}),t}const U=typeof addEventListener=="function"&&typeof removeEventListener=="function",L=[];U&&addEventListener("offline",()=>{L.forEach(n=>n())},!1);class w extends f{constructor(e,t){if(super(),this.binaryType=Ae,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const s=F(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=F(t.host).host);P(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Fe(this.opts.query)),U&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},L.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=le,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&w.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",w.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(t+=Oe(i)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,I(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,i){if(typeof t=="function"&&(i=t,t=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const o={type:e,data:t,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(w.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),U&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=L.indexOf(this._offlineEventListener);s!==-1&&L.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}w.protocol=le;class et extends w{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;w.priorWebsocketSuccess=!1;const i=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",p=>{if(!s)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;w.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=t.name,this.emitReserved("upgradeError",m)}}))};function o(){s||(s=!0,u(),t.close(),t=null)}const r=p=>{const m=new Error("probe error: "+p);m.transport=t.name,o(),this.emitReserved("upgradeError",m)};function a(){r("transport closed")}function c(){r("socket closed")}function d(p){t&&p.name!==t.name&&o()}const u=()=>{t.removeListener("open",i),t.removeListener("error",r),t.removeListener("close",a),this.off("close",c),this.off("upgrading",d)};t.once("open",i),t.once("error",r),t.once("close",a),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let tt=class extends et{constructor(e,t={}){const s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>Ye[i]).filter(i=>!!i)),super(e,s)}};function st(n,e="",t){let s=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),s=F(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const o=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+o+":"+s.port+e,s.href=s.protocol+"://"+o+(t&&t.port===s.port?"":":"+s.port),s}const it=typeof ArrayBuffer=="function",nt=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,me=Object.prototype.toString,ot=typeof Blob=="function"||typeof Blob!="undefined"&&me.call(Blob)==="[object BlobConstructor]",rt=typeof File=="function"||typeof File!="undefined"&&me.call(File)==="[object FileConstructor]";function J(n){return it&&(n instanceof ArrayBuffer||nt(n))||ot&&n instanceof Blob||rt&&n instanceof File}function B(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,s=n.length;t<s;t++)if(B(n[t]))return!0;return!1}if(J(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return B(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&B(n[t]))return!0;return!1}function at(n){const e=[],t=n.data,s=n;return s.data=V(t,e),s.attachments=e.length,{packet:s,buffers:e}}function V(n,e){if(!n)return n;if(J(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let s=0;s<n.length;s++)t[s]=V(n[s],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=V(n[s],e));return t}return n}function ct(n,e){return n.data=H(n.data,e),delete n.attachments,n}function H(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=H(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=H(n[t],e));return n}const lt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],dt=5;var l;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(l||(l={}));class ht{constructor(e){this.replacer=e}encode(e){return(e.type===l.EVENT||e.type===l.ACK)&&B(e)?this.encodeAsBinary({type:e.type===l.EVENT?l.BINARY_EVENT:l.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===l.BINARY_EVENT||e.type===l.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=at(e),s=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(s),i}}function se(n){return Object.prototype.toString.call(n)==="[object Object]"}class W extends f{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===l.BINARY_EVENT;s||t.type===l.BINARY_ACK?(t.type=s?l.EVENT:l.ACK,this.reconstructor=new ut(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(J(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(l[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===l.BINARY_EVENT||s.type===l.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const r=e.substring(o,t);if(r!=Number(r)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(r)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(o,t)}else s.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const r=e.charAt(t);if(r==null||Number(r)!=r){--t;break}if(t===e.length)break}s.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(W.isPayloadValid(s.type,o))s.data=o;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case l.CONNECT:return se(t);case l.DISCONNECT:return t===void 0;case l.CONNECT_ERROR:return typeof t=="string"||se(t);case l.EVENT:case l.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&lt.indexOf(t[0])===-1);case l.ACK:case l.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ut{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=ct(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const pt=Object.freeze(Object.defineProperty({__proto__:null,Decoder:W,Encoder:ht,get PacketType(){return l},protocol:dt},Symbol.toStringTag,{value:"Module"}));function v(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const ft=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ge extends f{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[v(e,"open",this.onopen.bind(this)),v(e,"packet",this.onpacket.bind(this)),v(e,"error",this.onerror.bind(this)),v(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,i,o;if(ft.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:l.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const u=this.ids++,p=t.pop();this._registerAckCallback(u,p),r.id=u}const a=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),r=(...a)=>{this.io.clearTimeoutFn(o),t.apply(this,a)};r.withError=!0,this.acks[e]=r}emitWithAck(e,...t){return new Promise((s,i)=>{const o=(r,a)=>r?i(r):s(a);o.withError=!0,t.push(o),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:l.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case l.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case l.EVENT:case l.BINARY_EVENT:this.onevent(e);break;case l.ACK:case l.BINARY_ACK:this.onack(e);break;case l.DISCONNECT:this.ondisconnect();break;case l.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...i){s||(s=!0,t.packet({type:l.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:l.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function k(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}k.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};k.prototype.reset=function(){this.attempts=0};k.prototype.setMin=function(n){this.ms=n};k.prototype.setMax=function(n){this.max=n};k.prototype.setJitter=function(n){this.jitter=n};class j extends f{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,P(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||pt;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new tt(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=v(t,"open",function(){s.onopen(),e&&e()}),o=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},r=v(t,"error",o);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),t.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(r),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(v(e,"ping",this.onping.bind(this)),v(e,"data",this.ondata.bind(this)),v(e,"error",this.onerror.bind(this)),v(e,"close",this.onclose.bind(this)),v(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){I(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new ge(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const E={};function A(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=st(n,e.path||"/socket.io"),s=t.source,i=t.id,o=t.path,r=E[i]&&o in E[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||r;let c;return a?c=new j(s,e):(E[i]||(E[i]=new j(s,e)),c=E[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(A,{Manager:j,Socket:ge,io:A,connect:A});class mt{constructor(){this.socket=null,this.isConnected=!1,this.serverUrl="http://localhost:3001"}connect(){if(this.socket&&this.isConnected){console.warn("Socket already connected");return}console.log("🔌 Connecting to BeeMoo server...",this.serverUrl),this.socket=A(this.serverUrl,{cors:{origin:"http://localhost:3000",methods:["GET","POST"]}}),this.setupEventListeners()}setupEventListeners(){this.socket.on("connect",()=>{this.isConnected=!0,console.log("✅ Connected to BeeMoo server:",this.socket.id),this.updateConnectionStatus(!0)}),this.socket.on("disconnect",()=>{this.isConnected=!1,console.log("❌ Disconnected from BeeMoo server"),this.updateConnectionStatus(!1)}),this.socket.on("connect_error",e=>{console.error("🚨 Connection error:",e),this.updateConnectionStatus(!1)})}updateConnectionStatus(e){const t=document.querySelector(".connection-status");t&&(t.textContent=e?"🟢 Connected":"🔴 Disconnected",t.className=`connection-status ${e?"connected":"disconnected"}`)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1)}emit(e,t){this.socket&&this.isConnected?this.socket.emit(e,t):console.warn("Cannot emit - socket not connected")}on(e,t){this.socket&&this.socket.on(e,t)}off(e,t){this.socket&&this.socket.off(e,t)}}class gt{constructor(e,t){this.socketClient=e,this.onRoomCreated=t,this.isVisible=!1,this.isCreating=!1,this.modal=null,this.focusTimeoutId=null,this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.handleUsernameSubmit=this.handleUsernameSubmit.bind(this),this.handleCopyRoomCode=this.handleCopyRoomCode.bind(this),this.handleJoinCreatedRoom=this.handleJoinCreatedRoom.bind(this)}show(){this.isVisible||(this.isVisible=!0,this.render(),this.setupEventListeners(),typeof document!="undefined"&&(this.focusTimeoutId=setTimeout(()=>{if(!this.isVisible||typeof document=="undefined")return;const e=document.getElementById("create-username-input");e&&e.focus()},100)))}hide(){this.isVisible&&(this.isVisible=!1,this.focusTimeoutId&&(clearTimeout(this.focusTimeoutId),this.focusTimeoutId=null),this.modal&&(this.modal.remove(),this.modal=null))}render(){document.body.insertAdjacentHTML("beforeend",`
      <div class="modal-overlay" id="room-creation-modal">
        <div class="modal-content" role="dialog" aria-labelledby="create-room-title" aria-modal="true">
          <div class="modal-header">
            <h2 id="create-room-title">🏠 Create New Room</h2>
            <button class="modal-close" aria-label="Close" id="close-create-modal">&times;</button>
          </div>
          
          <div class="modal-body">
            <div id="username-step" class="step-content active">
              <div class="step-header">
                <h3>Choose Your Username</h3>
                <p>You'll be the host and control movie playback</p>
              </div>
              
              <form id="username-form" class="form-group">
                <label for="create-username-input" class="form-label">Username</label>
                <input 
                  type="text" 
                  id="create-username-input" 
                  class="form-input" 
                  placeholder="Enter your username..."
                  maxlength="30"
                  required
                  aria-describedby="username-help"
                >
                <small id="username-help" class="form-help">
                  2-30 characters, letters, numbers, and basic punctuation
                </small>
                <div id="username-error" class="form-error" aria-live="polite"></div>
                
                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" id="cancel-create">
                    Cancel
                  </button>
                  <button type="submit" class="btn btn-primary" id="submit-username">
                    <span class="btn-text">Create Room</span>
                    <span class="btn-loader" style="display: none;">
                      <span class="spinner"></span> Creating...
                    </span>
                  </button>
                </div>
              </form>
            </div>
            
            <div id="room-code-step" class="step-content">
              <div class="step-header">
                <h3>🎉 Room Created Successfully!</h3>
                <p>Share this code with friends to invite them</p>
              </div>
              
              <div class="room-code-display">
                <label class="form-label">Room Code</label>
                <div class="room-code-container">
                  <span id="room-code-text" class="room-code">XXXXXX</span>
                  <button 
                    type="button" 
                    class="btn btn-icon" 
                    id="copy-room-code"
                    aria-label="Copy room code to clipboard"
                    title="Copy to clipboard"
                  >
                    📋
                  </button>
                </div>
                <small class="form-help">
                  Friends can join by entering this code
                </small>
              </div>
              
              <div class="host-info">
                <h4>As the host, you can:</h4>
                <ul>
                  <li>🎬 Control movie playback (play, pause, seek)</li>
                  <li>🎤 Manage voice chat</li>
                  <li>👥 See all participants</li>
                  <li>🗑️ End the room at any time</li>
                </ul>
              </div>
              
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="create-another">
                  Create Another Room
                </button>
                <button type="button" class="btn btn-primary" id="join-created-room">
                  Enter Room
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("room-creation-modal")}setupEventListeners(){if(!this.modal)return;const e=this.modal.querySelector("#close-create-modal"),t=this.modal.querySelector("#cancel-create"),s=this.modal;e==null||e.addEventListener("click",this.hide),t==null||t.addEventListener("click",this.hide),s==null||s.addEventListener("click",d=>{d.target===s&&this.hide()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&this.isVisible&&this.hide()});const i=this.modal.querySelector("#username-form");i==null||i.addEventListener("submit",this.handleUsernameSubmit);const o=this.modal.querySelector("#copy-room-code"),r=this.modal.querySelector("#join-created-room"),a=this.modal.querySelector("#create-another");o==null||o.addEventListener("click",this.handleCopyRoomCode),r==null||r.addEventListener("click",this.handleJoinCreatedRoom),a==null||a.addEventListener("click",()=>{this.showUsernameStep()});const c=this.modal.querySelector("#create-username-input");c==null||c.addEventListener("input",this.validateUsername.bind(this))}validateUsername(e){const s=e.target.value.trim(),i=document.getElementById("username-error");if(!i)return;if(s.length===0){i.textContent="";return}if(s.length<2){i.textContent="Username must be at least 2 characters";return}if(s.length>30){i.textContent="Username must be 30 characters or less";return}if(!/^[a-zA-Z0-9\s\-_\.]+$/.test(s)){i.textContent="Username contains invalid characters";return}if([/^(system|admin|host|server|bot)$/i,/^(moderator|mod|owner)$/i].some(a=>a.test(s))){i.textContent="This username is reserved";return}i.textContent=""}handleUsernameSubmit(e){return h(this,null,function*(){if(e.preventDefault(),this.isCreating)return;const t=document.getElementById("create-username-input"),s=document.getElementById("submit-username"),i=document.getElementById("username-error");if(!t||!s||!i)return;const o=t.value.trim();if(!o){i.textContent="Username is required",t.focus();return}this.isCreating=!0,this.setButtonLoading(s,!0),i.textContent="";try{const r=yield this.createRoom(o);r.success?(this.createdRoom={roomCode:r.roomCode,username:o,room:r.room,user:r.user,participants:r.user?[r.user]:[]},this.showRoomCodeStep(r.roomCode,o)):i.textContent=r.error||"Failed to create room. Please try again."}catch(r){console.error("Room creation error:",r),i.textContent="Connection error. Please check your connection and try again."}finally{this.isCreating=!1,this.setButtonLoading(s,!1)}})}createRoom(e){return h(this,null,function*(){return new Promise(t=>{const s=o=>{this.socketClient.off("room-created",s),this.socketClient.off("create-room-error",i),t({success:!0,roomCode:o.roomCode,room:o.room,user:o.user})},i=o=>{this.socketClient.off("room-created",s),this.socketClient.off("create-room-error",i),t({success:!1,error:o.error})};this.socketClient.on("room-created",s),this.socketClient.on("create-room-error",i),this.socketClient.emit("create-room",{username:e}),setTimeout(()=>{this.socketClient.off("room-created",s),this.socketClient.off("create-room-error",i),t({success:!1,error:"Request timeout. Please try again."})},1e4)})})}showRoomCodeStep(e,t){const s=document.getElementById("username-step"),i=document.getElementById("room-code-step"),o=document.getElementById("room-code-text");if(s&&i&&o){s.classList.remove("active"),i.classList.add("active"),o.textContent=e,this.createdRoom=G(X({},this.createdRoom||{}),{roomCode:e,username:t});const r=document.getElementById("announcements");r&&(r.textContent=`Room created successfully. Room code is ${e}`)}}showUsernameStep(){const e=document.getElementById("username-step"),t=document.getElementById("room-code-step"),s=document.getElementById("create-username-input"),i=document.getElementById("username-error");e&&t&&(t.classList.remove("active"),e.classList.add("active"),s&&(s.value="",s.focus()),i&&(i.textContent=""))}handleCopyRoomCode(){return h(this,null,function*(){const e=document.getElementById("room-code-text"),t=document.getElementById("copy-room-code");if(!e||!t)return;const s=e.textContent;try{yield navigator.clipboard.writeText(s),t.textContent="✅",t.setAttribute("title","Copied!");const i=document.getElementById("announcements");i&&(i.textContent="Room code copied to clipboard"),setTimeout(()=>{t.textContent="📋",t.setAttribute("title","Copy to clipboard")},2e3)}catch(i){console.error("Failed to copy room code:",i),alert(`Room Code: ${s}

Please copy this code manually.`)}})}handleJoinCreatedRoom(){this.createdRoom&&(this.hide(),this.onRoomCreated&&this.onRoomCreated(this.createdRoom))}setButtonLoading(e,t){if(!e)return;const s=e.querySelector(".btn-text"),i=e.querySelector(".btn-loader");t?(e.disabled=!0,s&&(s.style.display="none"),i&&(i.style.display="inline-flex")):(e.disabled=!1,s&&(s.style.display="inline"),i&&(i.style.display="none"))}destroy(){this.hide(),document.removeEventListener("keydown",this.handleEscKey),this.focusTimeoutId&&(clearTimeout(this.focusTimeoutId),this.focusTimeoutId=null)}}class yt{constructor(e,t){this.socketClient=e,this.onRoomJoined=t,this.isVisible=!1,this.isJoining=!1,this.isValidatingCode=!1,this.modal=null,this.currentRoomCode=null,this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.handleRoomCodeSubmit=this.handleRoomCodeSubmit.bind(this),this.handleUsernameSubmit=this.handleUsernameSubmit.bind(this),this.handleJoinRoom=this.handleJoinRoom.bind(this)}show(){this.isVisible||(this.isVisible=!0,this.render(),this.setupEventListeners(),setTimeout(()=>{const e=document.getElementById("join-room-code-input");e&&e.focus()},100))}hide(){this.isVisible&&(this.isVisible=!1,this.modal&&(this.modal.remove(),this.modal=null),this.currentRoomCode=null,this.isJoining=!1,this.isValidatingCode=!1)}render(){document.body.insertAdjacentHTML("beforeend",`
      <div class="modal-overlay" id="room-joining-modal">
        <div class="modal-content" role="dialog" aria-labelledby="join-room-title" aria-modal="true">
          <div class="modal-header">
            <h2 id="join-room-title">🚪 Join Room</h2>
            <button class="modal-close" aria-label="Close" id="close-join-modal">&times;</button>
          </div>
          
          <div class="modal-body">
            <div id="room-code-step" class="step-content active">
              <div class="step-header">
                <h3>Enter Room Code</h3>
                <p>Enter the 6-character code shared by the host</p>
              </div>
              
              <form id="room-code-form" class="form-group">
                <label for="join-room-code-input" class="form-label">Room Code</label>
                <input 
                  type="text" 
                  id="join-room-code-input" 
                  class="form-input room-code-input" 
                  placeholder="Enter room code..."
                  maxlength="6"
                  required
                  aria-describedby="room-code-help"
                  autocomplete="off"
                  spellcheck="false"
                >
                <small id="room-code-help" class="form-help">
                  6-character code (letters and numbers)
                </small>
                <div id="room-code-error" class="form-error" aria-live="polite"></div>
                
                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" id="cancel-join">
                    Cancel
                  </button>
                  <button type="submit" class="btn btn-primary" id="validate-room-code">
                    <span class="btn-text">Continue</span>
                    <span class="btn-loader" style="display: none;">
                      <span class="spinner"></span> Checking...
                    </span>
                  </button>
                </div>
              </form>
            </div>
            
            <div id="username-step" class="step-content">
              <div class="step-header">
                <h3>Choose Your Username</h3>
                <p>Join room <span id="display-room-code" class="room-code-inline">######</span></p>
              </div>
              
              <form id="join-username-form" class="form-group">
                <label for="join-username-input" class="form-label">Username</label>
                <input 
                  type="text" 
                  id="join-username-input" 
                  class="form-input" 
                  placeholder="Enter your username..."
                  maxlength="30"
                  required
                  aria-describedby="join-username-help"
                >
                <small id="join-username-help" class="form-help">
                  2-30 characters, letters, numbers, and basic punctuation
                </small>
                <div id="join-username-error" class="form-error" aria-live="polite"></div>
                
                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" id="back-to-code">
                    ← Back
                  </button>
                  <button type="submit" class="btn btn-primary" id="submit-join">
                    <span class="btn-text">Join Room</span>
                    <span class="btn-loader" style="display: none;">
                      <span class="spinner"></span> Joining...
                    </span>
                  </button>
                </div>
              </form>
            </div>
            
            <div id="success-step" class="step-content">
              <div class="step-header">
                <h3>🎉 Successfully Joined!</h3>
                <p>Welcome to room <span id="success-room-code" class="room-code-inline">######</span></p>
              </div>
              
              <div class="join-success-info">
                <h4>You're now connected:</h4>
                <ul>
                  <li>🎬 Watch movies synced with the host</li>
                  <li>🎤 Join voice chat with other participants</li>
                  <li>💬 Send messages in the room chat</li>
                  <li>🔊 Control your personal audio settings</li>
                </ul>
              </div>
              
              <div class="form-actions">
                <button type="button" class="btn btn-primary" id="enter-joined-room">
                  Enter Room
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("room-joining-modal")}setupEventListeners(){if(!this.modal)return;const e=this.modal.querySelector("#close-join-modal"),t=this.modal.querySelector("#cancel-join"),s=this.modal;e==null||e.addEventListener("click",this.hide),t==null||t.addEventListener("click",this.hide),s==null||s.addEventListener("click",u=>{u.target===s&&this.hide()}),document.addEventListener("keydown",u=>{u.key==="Escape"&&this.isVisible&&this.hide()});const i=this.modal.querySelector("#room-code-form"),o=this.modal.querySelector("#join-username-form");i==null||i.addEventListener("submit",this.handleRoomCodeSubmit),o==null||o.addEventListener("submit",this.handleUsernameSubmit);const r=this.modal.querySelector("#back-to-code"),a=this.modal.querySelector("#enter-joined-room");r==null||r.addEventListener("click",()=>this.showRoomCodeStep()),a==null||a.addEventListener("click",this.handleJoinRoom);const c=this.modal.querySelector("#join-room-code-input"),d=this.modal.querySelector("#join-username-input");c==null||c.addEventListener("input",this.formatRoomCode.bind(this)),c==null||c.addEventListener("input",this.validateRoomCodeInput.bind(this)),d==null||d.addEventListener("input",this.validateUsername.bind(this))}formatRoomCode(e){const t=e.target;let s=t.value.toUpperCase().replace(/[^A-Z0-9]/g,"");s.length>6&&(s=s.substring(0,6)),t.value=s}validateRoomCodeInput(e){const s=e.target.value.trim(),i=document.getElementById("room-code-error");if(i){if(s.length===0){i.textContent="";return}if(s.length<6){i.textContent="Room code must be 6 characters";return}if(!/^[A-Z0-9]{6}$/.test(s)){i.textContent="Room code can only contain letters and numbers";return}i.textContent=""}}validateUsername(e){const s=e.target.value.trim(),i=document.getElementById("join-username-error");if(!i)return;if(s.length===0){i.textContent="";return}if(s.length<2){i.textContent="Username must be at least 2 characters";return}if(s.length>30){i.textContent="Username must be 30 characters or less";return}if(!/^[a-zA-Z0-9\s\-_\.]+$/.test(s)){i.textContent="Username contains invalid characters";return}if([/^(system|admin|host|server|bot)$/i,/^(moderator|mod|owner)$/i].some(a=>a.test(s))){i.textContent="This username is reserved";return}i.textContent=""}handleRoomCodeSubmit(e){return h(this,null,function*(){if(e.preventDefault(),this.isValidatingCode)return;const t=document.getElementById("join-room-code-input"),s=document.getElementById("validate-room-code"),i=document.getElementById("room-code-error");if(!t||!s||!i)return;const o=t.value.trim().toUpperCase();if(!o){i.textContent="Room code is required",t.focus();return}if(o.length!==6){i.textContent="Room code must be 6 characters",t.focus();return}this.isValidatingCode=!0,this.setButtonLoading(s,!0),i.textContent="";try{const r=yield this.validateRoomCode(o);r.success?(this.currentRoomCode=o,this.showUsernameStep(o)):i.textContent=r.error||"Room not found. Please check the code and try again."}catch(r){console.error("Room validation error:",r),i.textContent="Connection error. Please check your connection and try again."}finally{this.isValidatingCode=!1,this.setButtonLoading(s,!1)}})}validateRoomCode(e){return h(this,null,function*(){return new Promise(t=>{const s=o=>{this.socketClient.off("room-exists",s),this.socketClient.off("room-not-found",i),t({success:!0,room:o.room})},i=o=>{this.socketClient.off("room-exists",s),this.socketClient.off("room-not-found",i),t({success:!1,error:o.error})};this.socketClient.on("room-exists",s),this.socketClient.on("room-not-found",i),this.socketClient.emit("validate-room",{roomCode:e}),setTimeout(()=>{this.socketClient.off("room-exists",s),this.socketClient.off("room-not-found",i),t({success:!1,error:"Request timeout. Please try again."})},1e4)})})}handleUsernameSubmit(e){return h(this,null,function*(){if(e.preventDefault(),this.isJoining)return;const t=document.getElementById("join-username-input"),s=document.getElementById("submit-join"),i=document.getElementById("join-username-error");if(!t||!s||!i||!this.currentRoomCode)return;const o=t.value.trim();if(!o){i.textContent="Username is required",t.focus();return}this.isJoining=!0,this.setButtonLoading(s,!0),i.textContent="";try{const r=yield this.joinRoom(this.currentRoomCode,o);r.success?this.showSuccessStep(this.currentRoomCode,o,r.room,r.participants):i.textContent=r.error||"Failed to join room. Please try again."}catch(r){console.error("Room joining error:",r),i.textContent="Connection error. Please check your connection and try again."}finally{this.isJoining=!1,this.setButtonLoading(s,!1)}})}joinRoom(e,t){return h(this,null,function*(){return new Promise(s=>{const i=r=>{this.socketClient.off("room-joined",i),this.socketClient.off("join-room-error",o),s({success:!0,room:r.room,user:r.user,participants:r.participants})},o=r=>{this.socketClient.off("room-joined",i),this.socketClient.off("join-room-error",o),s({success:!1,error:r.error})};this.socketClient.on("room-joined",i),this.socketClient.on("join-room-error",o),this.socketClient.emit("join-room",{roomCode:e,username:t}),setTimeout(()=>{this.socketClient.off("room-joined",i),this.socketClient.off("join-room-error",o),s({success:!1,error:"Request timeout. Please try again."})},1e4)})})}showRoomCodeStep(){const e=document.getElementById("room-code-step"),t=document.getElementById("username-step"),s=document.getElementById("join-room-code-input"),i=document.getElementById("room-code-error");e&&t&&(t.classList.remove("active"),e.classList.add("active"),s&&s.focus(),i&&(i.textContent=""))}showUsernameStep(e){const t=document.getElementById("room-code-step"),s=document.getElementById("username-step"),i=document.getElementById("join-username-input"),o=document.getElementById("display-room-code"),r=document.getElementById("join-username-error");if(t&&s){t.classList.remove("active"),s.classList.add("active"),o&&(o.textContent=e),i&&(i.value="",i.focus()),r&&(r.textContent="");const a=document.getElementById("announcements");a&&(a.textContent=`Room ${e} found. Please enter your username.`)}}showSuccessStep(e,t,s,i){const o=document.getElementById("username-step"),r=document.getElementById("success-step"),a=document.getElementById("success-room-code");if(o&&r){o.classList.remove("active"),r.classList.add("active"),a&&(a.textContent=e),this.joinedRoom={roomCode:e,username:t,room:s,participants:i};const c=document.getElementById("announcements");c&&(c.textContent=`Successfully joined room ${e}`)}}handleJoinRoom(){this.joinedRoom&&(this.hide(),this.onRoomJoined&&this.onRoomJoined(this.joinedRoom))}setButtonLoading(e,t){if(!e)return;const s=e.querySelector(".btn-text"),i=e.querySelector(".btn-loader");t?(e.disabled=!0,s&&(s.style.display="none"),i&&(i.style.display="inline-flex")):(e.disabled=!1,s&&(s.style.display="inline"),i&&(i.style.display="none"))}destroy(){this.hide(),document.removeEventListener("keydown",this.handleEscKey)}}class vt{constructor(e){this.socketClient=e,this.container=null,this.participantsBySocketId=new Map,this.socketIdToVolume=new Map,this.boundHandlers=!1,this.onVolumeChange=null,this.attach=this.attach.bind(this),this.detach=this.detach.bind(this),this.destroy=this.destroy.bind(this),this.setParticipants=this.setParticipants.bind(this),this.addOrUpdateParticipant=this.addOrUpdateParticipant.bind(this),this.removeParticipant=this.removeParticipant.bind(this),this.render=this.render.bind(this),this.renderItem=this.renderItem.bind(this),this.bindSocketEvents=this.bindSocketEvents.bind(this),this.unbindSocketEvents=this.unbindSocketEvents.bind(this),this.onParticipantJoined=this.onParticipantJoined.bind(this),this.onParticipantLeft=this.onParticipantLeft.bind(this),this.onParticipantMicUpdated=this.onParticipantMicUpdated.bind(this),this.onParticipantDisconnected=this.onParticipantDisconnected.bind(this),this._onVolumeInput=this._onVolumeInput.bind(this)}attach(e){e&&(this.container=e,this.container.classList.add("participants-panel"),this.render(),this.bindSocketEvents(),this.container.addEventListener("input",this._onVolumeInput))}detach(){this.container&&(this.container.removeEventListener("input",this._onVolumeInput),this.container.innerHTML="",this.container.classList.remove("participants-panel")),this.container=null,this.unbindSocketEvents()}destroy(){this.detach(),this.participantsBySocketId.clear()}bindSocketEvents(){this.boundHandlers||(this.socketClient.on("participant-joined",this.onParticipantJoined),this.socketClient.on("participant-left",this.onParticipantLeft),this.socketClient.on("participant-mic-updated",this.onParticipantMicUpdated),this.socketClient.on("mic-updated",this.onParticipantMicUpdated),this.socketClient.on("participant-disconnected",this.onParticipantDisconnected),this.boundHandlers=!0)}unbindSocketEvents(){this.boundHandlers&&(this.socketClient.off("participant-joined",this.onParticipantJoined),this.socketClient.off("participant-left",this.onParticipantLeft),this.socketClient.off("participant-mic-updated",this.onParticipantMicUpdated),this.socketClient.off("mic-updated",this.onParticipantMicUpdated),this.socketClient.off("participant-disconnected",this.onParticipantDisconnected),this.boundHandlers=!1)}setParticipants(e){if(this.participantsBySocketId.clear(),Array.isArray(e))for(const t of e)t&&t.socketId&&this.participantsBySocketId.set(t.socketId,{socketId:t.socketId,username:t.username||"Unknown",isHost:!!t.isHost,muted:typeof t.micMuted=="boolean"?t.micMuted:!!t.muted});this.render()}addOrUpdateParticipant(e){var s,i,o,r,a,c;if(!e||!e.socketId)return;const t=this.participantsBySocketId.get(e.socketId)||{};this.participantsBySocketId.set(e.socketId,{socketId:e.socketId,username:(i=(s=e.username)!=null?s:t.username)!=null?i:"Unknown",isHost:(r=(o=e.isHost)!=null?o:t.isHost)!=null?r:!1,muted:(c=(a=typeof e.micMuted=="boolean"?e.micMuted:e.muted)!=null?a:t.muted)!=null?c:!1}),this.render()}removeParticipant(e){!e||!e.socketId||(this.participantsBySocketId.delete(e.socketId),this.render())}onParticipantJoined(e){if(e!=null&&e.participants){this.setParticipants(e.participants);return}e!=null&&e.participant&&this.addOrUpdateParticipant(e.participant)}onParticipantLeft(e){if(e!=null&&e.participants){this.setParticipants(e.participants);return}e!=null&&e.participant&&this.removeParticipant(e.participant)}onParticipantMicUpdated(e){if(e!=null&&e.participants){this.setParticipants(e.participants);return}e!=null&&e.participant&&this.addOrUpdateParticipant(e.participant)}onParticipantDisconnected(e){if(e!=null&&e.participants){this.setParticipants(e.participants);return}e!=null&&e.participant&&this.removeParticipant(e.participant)}render(){if(!this.container)return;const e=Array.from(this.participantsBySocketId.values()),t=`
      <div class="participants-header">
        <h3 class="participants-title">Participants</h3>
        <span class="participants-count" aria-live="polite">${e.length}</span>
      </div>
    `,i=`
      <ul class="participants-list" role="list">
        ${e.map(this.renderItem).join("")||'<li class="participant empty">Waiting for participants…</li>'}
      </ul>
    `;this.container.innerHTML=t+i}renderItem(e){var c;const t=e.muted?"🔇":"🎤",s=e.muted?"muted":"live",i=e.isHost?'<span class="badge badge-host" title="Host">HOST</span>':"",o=Math.round((c=this.socketIdToVolume.get(e.socketId))!=null?c:100),r=this.escapeHtml(e.username),a=String(e.username).replace(/[<>]/g,"");return`
      <li class="participant" data-socket-id="${e.socketId}">
        <div class="participant-left">
          <span class="participant-avatar" aria-hidden="true">${e.username.charAt(0).toUpperCase()}</span>
          <div class="participant-info">
            <span class="participant-name">${r} ${i}</span>
          </div>
        </div>
        <div class="participant-right">
          <input type="range" class="participant-volume" data-socket-id="${e.socketId}" min="0" max="100" value="${o}" aria-label="Volume for ${a}" />
          <span class="participant-mic ${s}" aria-label="${e.muted?"Muted":"Unmuted"}">${t}</span>
        </div>
      </li>
    `}escapeHtml(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}_onVolumeInput(e){const t=e.target;if(!t.classList.contains("participant-volume"))return;const s=t.getAttribute("data-socket-id"),i=Math.max(0,Math.min(100,parseInt(t.value||"0",10)));this.socketIdToVolume.set(s,i),typeof this.onVolumeChange=="function"&&this.onVolumeChange(s,i/100)}}class x{static getAudioConstraints(e={}){const{echoCancellation:t=!0,noiseSuppression:s=!0,autoGainControl:i=!0,deviceId:o=void 0}=e,r={audio:{echoCancellation:t,noiseSuppression:s,autoGainControl:i},video:!1};return o&&(r.audio.deviceId={exact:o}),r}static requestMicrophonePermissions(){return h(this,null,function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1})).getTracks().forEach(t=>t.stop()),{granted:!0}}catch(e){return{granted:!1,error:e}}})}static listAudioInputDevices(){return h(this,null,function*(){try{return{success:!0,devices:(yield navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="audioinput").map(s=>({deviceId:s.deviceId,label:s.label||"Microphone",groupId:s.groupId||void 0}))}}catch(e){return{success:!1,error:e}}})}}class bt{constructor(e){this.socket=e,this.handlers={offer:null,answer:null,ice:null}}onOffer(e){this.handlers.offer=e,this.socket.on("webrtc-offer",e)}onAnswer(e){this.handlers.answer=e,this.socket.on("webrtc-answer",e)}onIceCandidate(e){this.handlers.ice=e,this.socket.on("webrtc-ice-candidate",e)}offAll(){this.handlers.offer&&this.socket.off("webrtc-offer",this.handlers.offer),this.handlers.answer&&this.socket.off("webrtc-answer",this.handlers.answer),this.handlers.ice&&this.socket.off("webrtc-ice-candidate",this.handlers.ice),this.handlers={offer:null,answer:null,ice:null}}sendOffer(e,t){this.socket.emit("webrtc-offer",{sdp:e,to:t})}sendAnswer(e,t){this.socket.emit("webrtc-answer",{sdp:e,to:t})}sendIceCandidate(e,t){this.socket.emit("webrtc-ice-candidate",{candidate:e,to:t})}}class ie{constructor(e,t){this.socketClient=e,this.signaling=new bt(e),this.peerIdToPc=new Map,this.localStreamProvider=t,this.onRemoteTrack=null,this.currentLocalStream=null,this.signaling.onOffer(o=>h(this,[o],function*({from:s,sdp:i}){yield this.handleOffer(s,i)})),this.signaling.onAnswer(o=>h(this,[o],function*({from:s,sdp:i}){yield this.handleAnswer(s,i)})),this.signaling.onIceCandidate(o=>h(this,[o],function*({from:s,candidate:i}){const r=this.peerIdToPc.get(s);if(r&&i)try{yield r.addIceCandidate(i)}catch(a){}}))}ensurePeer(e){return h(this,null,function*(){if(this.peerIdToPc.has(e))return this.peerIdToPc.get(e);const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});t.onicecandidate=i=>{i.candidate&&this.signaling.sendIceCandidate(i.candidate,e)},t.ontrack=i=>{this.onRemoteTrack&&i.streams&&i.streams[0]&&this.onRemoteTrack(e,i.streams[0])};const s=yield this._getOrCreateLocalStream();return s.getTracks().forEach(i=>t.addTrack(i,s)),this.peerIdToPc.set(e,t),t})}callPeer(e){return h(this,null,function*(){const t=yield this.ensurePeer(e),s=yield t.createOffer();yield t.setLocalDescription(s),this.signaling.sendOffer(s,e)})}handleOffer(e,t){return h(this,null,function*(){const s=yield this.ensurePeer(e);yield s.setRemoteDescription(new RTCSessionDescription(t));const i=yield s.createAnswer();yield s.setLocalDescription(i),this.signaling.sendAnswer(i,e)})}handleAnswer(e,t){return h(this,null,function*(){const s=this.peerIdToPc.get(e);s&&(yield s.setRemoteDescription(new RTCSessionDescription(t)))})}closePeer(e){const t=this.peerIdToPc.get(e);t&&(t.getSenders().forEach(s=>{try{t.removeTrack(s)}catch(i){}}),t.close(),this.peerIdToPc.delete(e))}replaceLocalStream(e){return h(this,null,function*(){this.currentLocalStream=e;for(const t of this.peerIdToPc.values()){const s=t.getSenders().filter(o=>o.track&&o.track.kind==="audio"),i=e.getAudioTracks()[0];for(const o of s)try{yield o.replaceTrack(i)}catch(r){}}})}_getOrCreateLocalStream(){return h(this,null,function*(){return this.currentLocalStream?this.currentLocalStream:(this.currentLocalStream=yield this.localStreamProvider(),this.currentLocalStream)})}destroy(){for(const e of Array.from(this.peerIdToPc.keys()))this.closePeer(e);this.signaling.offAll()}}class Ct{constructor(e,t){this.socketClient=e,this.onFileSelected=t,this.selectedFile=null,this.isUploading=!1,this.supportedFormats={"video/mp4":{ext:"mp4",name:"MP4 (H.264)"},"video/webm":{ext:"webm",name:"WebM"},"video/ogg":{ext:"ogv",name:"Ogg Video"},"video/quicktime":{ext:"mov",name:"QuickTime (limited support)"}},this.maxFileSize=500*1024*1024}render(){return`
      <div class="movie-file-selector" id="movie-file-selector">
        <div class="file-selector-header">
          <h3>Select Movie File</h3>
          <p class="file-selector-desc">Choose a video file to stream to your party</p>
        </div>
        
        <div class="file-input-container">
          <label for="movie-file-input" class="file-input-label">
            <div class="file-input-drop-zone" id="drop-zone">
              <div class="file-input-content">
                <svg class="file-upload-icon" viewBox="0 0 24 24" width="48" height="48">
                  <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                </svg>
                <div class="file-input-text">
                  <span class="file-input-primary">Drop video file here or click to browse</span>
                  <span class="file-input-secondary">Supports MP4, WebM, OGG • Max 500MB</span>
                </div>
              </div>
            </div>
            <input 
              type="file" 
              id="movie-file-input" 
              accept="video/mp4,video/webm,video/ogg,video/quicktime" 
              class="file-input-hidden"
            />
          </label>
        </div>

        <div class="file-validation-info" id="validation-info" style="display: none;">
          <div class="file-info">
            <div class="file-details">
              <span class="file-name" id="file-name"></span>
              <span class="file-meta" id="file-meta"></span>
            </div>
            <div class="file-status" id="file-status"></div>
          </div>
          <div class="file-actions">
            <button type="button" class="btn btn-secondary btn-small" id="clear-file">
              Remove File
            </button>
            <button type="button" class="btn btn-primary" id="start-streaming" disabled>
              Start Streaming
            </button>
          </div>
        </div>

        <div class="upload-progress" id="upload-progress" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
          </div>
          <div class="progress-text">
            <span id="progress-percent">0%</span>
            <span id="progress-status">Preparing file...</span>
          </div>
        </div>

        <div class="format-support-info">
          <details class="support-details">
            <summary>Supported Video Formats</summary>
            <div class="format-list">
              <div class="format-item recommended">
                <strong>MP4 (H.264)</strong> - Best compatibility, recommended
              </div>
              <div class="format-item">
                <strong>WebM</strong> - Good compression, modern browsers
              </div>
              <div class="format-item">
                <strong>OGG Video</strong> - Open source format
              </div>
              <div class="format-item limited">
                <strong>QuickTime (MOV)</strong> - Limited browser support
              </div>
            </div>
          </details>
        </div>
      </div>
    `}mount(e){e&&(e.innerHTML=this.render(),this.setupEventListeners())}setupEventListeners(){const e=document.getElementById("movie-file-input"),t=document.getElementById("drop-zone"),s=document.getElementById("clear-file"),i=document.getElementById("start-streaming");e==null||e.addEventListener("change",o=>{this.handleFileSelection(o.target.files[0])}),t==null||t.addEventListener("dragover",o=>{o.preventDefault(),t.classList.add("drag-over")}),t==null||t.addEventListener("dragleave",o=>{o.preventDefault(),t.classList.remove("drag-over")}),t==null||t.addEventListener("drop",o=>{o.preventDefault(),t.classList.remove("drag-over");const r=o.dataTransfer.files;r.length>0&&this.handleFileSelection(r[0])}),s==null||s.addEventListener("click",()=>{this.clearFile()}),i==null||i.addEventListener("click",()=>{this.startStreaming()})}handleFileSelection(e){return h(this,null,function*(){if(!e)return;this.hideUploadProgress();const t=yield this.validateFileAdvanced(e);if(!t.valid){this.showValidationError(t.error);return}this.selectedFile=e,this.showFileInfo(e),this.showValidationInfo();const s=document.getElementById("start-streaming");s&&(s.disabled=!1),console.log("✅ File selected:",e.name,this.formatFileSize(e.size))})}validateFile(e){return e?this.supportedFormats[e.type]?e.size>this.maxFileSize?{valid:!1,error:`File too large. Maximum size is ${this.formatFileSize(this.maxFileSize)}`}:{valid:!0}:{valid:!1,error:`Unsupported video format. Please use: ${Object.values(this.supportedFormats).map(s=>s.name).join(", ")}`}:{valid:!1,error:"No file selected"}}validateFileAdvanced(e){return h(this,null,function*(){const t=this.validateFile(e);return t.valid?new Promise(s=>{const i=new FileReader;i.onload=o=>{const r=new Uint8Array(o.target.result),a=this.isVideoFile(r,e.type);s(a?{valid:!0}:{valid:!1,error:"File does not appear to be a valid video"})},i.onerror=()=>{s({valid:!1,error:"Could not read file"})},i.readAsArrayBuffer(e.slice(0,1024))}):t})}isVideoFile(e,t){const i={"video/mp4":[0,0,0,null,102,116,121,112],"video/webm":[26,69,223,163],"video/ogg":[79,103,103,83]}[t];if(!i)return!0;for(let o=0;o<i.length;o++)if(i[o]!==null&&e[o]!==i[o])return!1;return!0}showFileInfo(e){const t=document.getElementById("file-name"),s=document.getElementById("file-meta"),i=document.getElementById("file-status");if(t&&(t.textContent=e.name),s){const o=this.supportedFormats[e.type];s.textContent=`${o.name} • ${this.formatFileSize(e.size)}`}i&&(i.innerHTML='<span class="status-ready">✓ Ready to stream</span>')}showValidationInfo(){const e=document.getElementById("validation-info");e&&(e.style.display="block")}showValidationError(e){const t=document.getElementById("file-status");t&&(t.innerHTML=`<span class="status-error">✗ ${this.escapeHtml(e)}</span>`),this.showValidationInfo();const s=document.getElementById("start-streaming");s&&(s.disabled=!0)}clearFile(){this.selectedFile=null;const e=document.getElementById("movie-file-input");e&&(e.value="");const t=document.getElementById("validation-info");t&&(t.style.display="none"),this.hideUploadProgress(),console.log("📝 File selection cleared")}startStreaming(){return h(this,null,function*(){if(!(!this.selectedFile||this.isUploading)){this.isUploading=!0,this.showUploadProgress();try{yield this.simulateUpload(),this.onFileSelected&&this.onFileSelected({file:this.selectedFile,url:URL.createObjectURL(this.selectedFile),type:this.selectedFile.type,size:this.selectedFile.size,name:this.selectedFile.name}),console.log("🎬 Movie streaming started:",this.selectedFile.name)}catch(e){console.error("❌ Streaming failed:",e),this.showValidationError("Failed to start streaming: "+e.message)}finally{this.isUploading=!1,this.hideUploadProgress()}}})}simulateUpload(){return h(this,null,function*(){for(let t=0;t<=20;t++){const s=Math.round(t/20*100);this.updateProgress(s,t===0?"Preparing file...":t===20?"Ready to stream!":"Processing..."),yield new Promise(i=>setTimeout(i,100))}})}showUploadProgress(){const e=document.getElementById("upload-progress");e&&(e.style.display="block");const t=document.getElementById("start-streaming");t&&(t.disabled=!0,t.textContent="Processing...")}hideUploadProgress(){const e=document.getElementById("upload-progress");e&&(e.style.display="none");const t=document.getElementById("start-streaming");t&&(t.disabled=!this.selectedFile,t.textContent="Start Streaming")}updateProgress(e,t){const s=document.getElementById("progress-fill"),i=document.getElementById("progress-percent"),o=document.getElementById("progress-status");s&&(s.style.width=`${e}%`),i&&(i.textContent=`${e}%`),o&&(o.textContent=t)}formatFileSize(e){if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+s[i]}escapeHtml(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}destroy(){this.selectedFile&&this.clearFile()}}class wt{constructor(e){this.socketClient=e,this.root=null,this.participantList=new vt(e),this.movieFileSelector=null,this.peerManager=null,this.voiceActive=!1,this.participants=new Map,this.boundHandlers=!1,this.isHost=!1,this.selectedMovie=null}mount(e,t){var c,d,u;if(!e)return;this.root=e,this.isHost=((c=t==null?void 0:t.user)==null?void 0:c.isHost)||!1,console.log("🔍 RoomView host detection:",{initialData:t,user:t==null?void 0:t.user,isHost:this.isHost,socketId:(u=(d=this.socketClient)==null?void 0:d.socket)==null?void 0:u.id}),this.root.innerHTML=this.render(t);const s=this.root.querySelector("#participants-container");if(this.participantList.attach(s),t!=null&&t.participants){this.participantList.setParticipants(t.participants);for(const p of t.participants)p&&p.socketId&&this.participants.set(p.socketId,p)}this.isHost&&this.initializeMovieFileSelector();const i=this.root.querySelector("#request-mic");i&&i.addEventListener("click",()=>h(this,null,function*(){i.disabled=!0,(yield x.requestMicrophonePermissions()).granted||alert("Microphone permission denied. You can enable it later from browser settings.");const m=yield x.listAudioInputDevices();console.log("🎙️ Devices:",m),i.disabled=!1})),this.peerManager=new ie(this.socketClient,()=>h(this,null,function*(){try{return yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}catch(p){return console.warn("Microphone not available, using silent stream"),new(window.AudioContext||window.webkitAudioContext)().createMediaStreamDestination().stream}})),this.peerManager.onRemoteTrack=(p,m)=>{let y=this.root.querySelector(`audio[data-peer="${p}"]`);y||(y=document.createElement("audio"),y.dataset.peer=p,y.autoplay=!0,y.playsInline=!0,this.root.appendChild(y)),y.srcObject=m},this.participantList.onVolumeChange=(p,m)=>{const y=this.root.querySelector(`audio[data-peer="${p}"]`);y&&(y.volume=m)},this.bindRoomParticipantEvents();const o=this.root.querySelector("#toggle-voice");o&&o.addEventListener("click",()=>h(this,null,function*(){this.voiceActive?(this.stopVoice(),o.textContent="Start Voice"):(yield this.startVoice(),o.textContent="Stop Voice")})),this.populateMicDevices();const r=this.root.querySelector("#mic-toggle"),a=this.root.querySelector("#apply-audio");r==null||r.addEventListener("click",()=>this.toggleMic(r)),a==null||a.addEventListener("click",()=>this.applyAudioSettings())}initializeMovieFileSelector(){if(console.log("🎬 Attempting to initialize MovieFileSelector:",{isHost:this.isHost,hasRoot:!!this.root}),!this.isHost){console.log("🚫 Not host, skipping file selector initialization");return}const e=this.root.querySelector("#movie-file-selector-container");if(console.log("🎬 File selector container found:",!!e),!e){console.error("❌ movie-file-selector-container not found in DOM");return}this.movieFileSelector=new Ct(this.socketClient,t=>this.handleMovieSelected(t)),this.movieFileSelector.mount(e),console.log("✅ Movie file selector initialized for host")}handleMovieSelected(e){this.selectedMovie=e,console.log("🎬 Movie selected:",e.name,e.size),this.socketClient.emit("movie-control",{action:"start-streaming",movieState:{title:e.name,type:e.type,size:e.size,url:e.url}}),this.updateMovieStage(e)}updateMovieStage(e){const t=this.root.querySelector("#movie-stage");if(!t)return;t.innerHTML=`
      <div class="movie-ready">
        <div class="movie-info">
          <h4>Movie Ready: ${this.escapeHtml(e.name)}</h4>
          <p>Format: ${this.escapeHtml(e.type)} • Size: ${this.formatFileSize(e.size)}</p>
        </div>
        <div class="movie-controls">
          <button class="btn btn-primary" id="play-movie">Play Movie</button>
          <button class="btn btn-secondary" id="change-movie">Change Movie</button>
        </div>
      </div>
    `;const s=this.root.querySelector("#play-movie"),i=this.root.querySelector("#change-movie");s==null||s.addEventListener("click",()=>this.playMovie()),i==null||i.addEventListener("click",()=>this.changeMovie())}playMovie(){this.selectedMovie&&(console.log("▶️ Starting movie playback"),this.socketClient.emit("movie-control",{action:"play",movieState:{currentTime:0}}))}changeMovie(){this.selectedMovie=null;const e=this.root.querySelector("#movie-stage");e&&(e.innerHTML='<div id="movie-file-selector-container"></div>',this.initializeMovieFileSelector())}formatFileSize(e){if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+s[i]}unmount(){this.participantList&&this.participantList.destroy(),this.movieFileSelector&&this.movieFileSelector.destroy(),this.peerManager&&this.peerManager.destroy(),this.unbindRoomParticipantEvents(),this.root&&(this.root.innerHTML=""),this.root=null}populateMicDevices(){return h(this,null,function*(){const e=this.root.querySelector("#mic-device");if(!e)return;const{devices:t}=yield x.listAudioInputDevices();e.innerHTML="",(t||[]).forEach(s=>{const i=document.createElement("option");i.value=s.deviceId,i.textContent=s.label||"Microphone",e.appendChild(i)})})}toggleMic(e){return h(this,null,function*(){var r;const t=(r=this.peerManager)==null?void 0:r.currentLocalStream,s=t==null?void 0:t.getAudioTracks()[0];if(!s)return;const i=!s.enabled;s.enabled=i,e.textContent=i?"Mute Mic":"Unmute Mic";const o=!i;this.socketClient.emit("mic-toggle",{muted:o})})}applyAudioSettings(){return h(this,null,function*(){var r,a,c;const e=this.root.querySelector("#mic-device"),t=(r=this.root.querySelector("#aec"))==null?void 0:r.checked,s=(a=this.root.querySelector("#ns"))==null?void 0:a.checked,i=(c=this.root.querySelector("#agc"))==null?void 0:c.checked,o=(e==null?void 0:e.value)||void 0;try{const d=x.getAudioConstraints({echoCancellation:t,noiseSuppression:s,autoGainControl:i,deviceId:o}),u=yield navigator.mediaDevices.getUserMedia(d);yield this.peerManager.replaceLocalStream(u)}catch(d){alert("Failed to apply audio settings. Check permissions and try again.")}})}startVoice(){return h(this,null,function*(){var t;this.voiceActive=!0;const e=(t=this.socketClient.socket)==null?void 0:t.id;for(const[s]of this.participants.entries())if(!(!s||s===e))try{yield this.peerManager.callPeer(s)}catch(i){}})}stopVoice(){var e,t;this.voiceActive=!1,this.peerManager&&(this.peerManager.destroy(),this.peerManager=new ie(this.socketClient,()=>h(this,null,function*(){try{return yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}catch(s){return new(window.AudioContext||window.webkitAudioContext)().createMediaStreamDestination().stream}})),this.peerManager.onRemoteTrack=(s,i)=>{let o=this.root.querySelector(`audio[data-peer="${s}"]`);o||(o=document.createElement("audio"),o.dataset.peer=s,o.autoplay=!0,o.playsInline=!0,this.root.appendChild(o)),o.srcObject=i}),(t=(e=this.root)==null?void 0:e.querySelectorAll("audio[data-peer]"))==null||t.forEach(s=>s.remove())}bindRoomParticipantEvents(){this.boundHandlers||(this._onJoined=({participant:e,participants:t})=>{if(t)for(const s of t)this.participants.set(s.socketId,s);else e&&(this.participants.set(e.socketId,e),this.voiceActive&&this.peerManager.callPeer(e.socketId).catch(()=>{}))},this._onLeft=({participant:e,participants:t})=>{if(t){this.participants.clear();for(const s of t)this.participants.set(s.socketId,s)}else e&&(this.participants.delete(e.socketId),this.voiceActive&&this.peerManager.closePeer(e.socketId))},this._onDisconnected=this._onLeft,this.socketClient.on("participant-joined",this._onJoined),this.socketClient.on("participant-left",this._onLeft),this.socketClient.on("participant-disconnected",this._onDisconnected),this.boundHandlers=!0)}unbindRoomParticipantEvents(){this.boundHandlers&&(this.socketClient.off("participant-joined",this._onJoined),this.socketClient.off("participant-left",this._onLeft),this.socketClient.off("participant-disconnected",this._onDisconnected),this.boundHandlers=!1)}renderMovieStage(){return this.isHost?this.selectedMovie?`
          <div class="movie-stage" id="movie-stage">
            <div class="movie-ready">
              <div class="movie-info">
                <h4>Movie Ready: ${this.escapeHtml(this.selectedMovie.name)}</h4>
                <p>Format: ${this.escapeHtml(this.selectedMovie.type)} • Size: ${this.formatFileSize(this.selectedMovie.size)}</p>
              </div>
              <div class="movie-controls">
                <button class="btn btn-primary" id="play-movie">Play Movie</button>
                <button class="btn btn-secondary" id="change-movie">Change Movie</button>
              </div>
            </div>
          </div>
        `:`
          <div class="movie-stage" id="movie-stage">
            <div id="movie-file-selector-container"></div>
          </div>
        `:`
        <div class="movie-stage" id="movie-stage">
          <div class="waiting-for-host">
            <div class="waiting-content">
              <svg class="waiting-icon" viewBox="0 0 24 24" width="64" height="64">
                <path fill="currentColor" d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.5L17,15L15.5,17.5L11.5,15V7H12.5Z" />
              </svg>
              <h3>Waiting for Host</h3>
              <p>The host will select and start the movie when ready.</p>
            </div>
          </div>
        </div>
      `}render(e){var i;const t=(e==null?void 0:e.roomCode)||"######",s=((i=e==null?void 0:e.room)==null?void 0:i.title)||"BeeMoo Room";return`
      <section class="room-shell" aria-label="Room">
        <header class="room-header">
          <h2 class="room-title">${this.escapeHtml(s)}</h2>
          <div class="room-meta">
            <span class="room-code-inline" title="Room Code">${this.escapeHtml(t)}</span>
            <button id="request-mic" class="btn btn-secondary btn-small" style="margin-left:8px">Enable Mic</button>
            <button id="toggle-voice" class="btn btn-primary btn-small" style="margin-left:8px">Start Voice</button>
          </div>
        </header>
        <div class="room-content">
          <aside class="room-sidebar" aria-label="Participants">
            <div id="participants-container"></div>
          </aside>
          <main class="room-main" aria-label="Stage">
            ${this.renderMovieStage()}
            <div class="audio-controls" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
              <button id="mic-toggle" class="btn btn-secondary btn-small">Mute Mic</button>
              <select id="mic-device" class="form-input" style="max-width:260px;"></select>
              <label style="display:flex; align-items:center; gap:6px; font-size:0.9rem;">
                <input type="checkbox" id="aec" checked /> Echo Cancellation
              </label>
              <label style="display:flex; align-items:center; gap:6px; font-size:0.9rem;">
                <input type="checkbox" id="ns" checked /> Noise Suppression
              </label>
              <label style="display:flex; align-items:center; gap:6px; font-size:0.9rem;">
                <input type="checkbox" id="agc" checked /> Auto Gain
              </label>
              <button id="apply-audio" class="btn btn-primary btn-small">Apply</button>
            </div>
          </main>
        </div>
      </section>
    `}escapeHtml(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}class kt{constructor(){this.appElement=document.getElementById("app"),this.socketClient=new mt,this.initialized=!1,this.currentView="landing",this.currentRoom=null,this.roomCreation=new gt(this.socketClient,e=>this.handleRoomCreated(e)),this.roomJoining=new yt(this.socketClient,e=>this.handleRoomJoined(e)),this.roomView=new wt(this.socketClient)}init(){if(this.initialized){console.warn("App already initialized");return}this.render(),this.setupEventListeners(),this.connectToServer(),this.initialized=!0,console.log("✅ BeeMoo app initialized successfully")}render(){if(!this.appElement){console.error("App element not found");return}this.appElement.innerHTML=`
      <div class="beemoo-app">
        <header role="banner" class="main-header">
          <div class="header-content">
            <div class="brand-row">
              <h1 class="logo">🎬 BeeMoo</h1>
              <button id="nav-toggle" class="nav-toggle" aria-label="Open menu" aria-controls="main-nav" aria-expanded="false">
                <span class="nav-toggle-bar" aria-hidden="true"></span>
                <span class="sr-only">Menu</span>
              </button>
            </div>
            <p class="tagline">Movie Party Meetings Platform</p>
            
          </div>
          <nav id="main-nav" class="main-nav" aria-label="Primary">
            <ul>
              <li><a href="#" id="nav-create">Create Room</a></li>
              <li><a href="#" id="nav-join">Join Room</a></li>
              <li><a href="#features" id="nav-features">Features</a></li>
            </ul>
          </nav>
        </header>

        <main id="main-content" role="main" class="landing-main">
          <section class="hero-section" aria-labelledby="hero-title">
            <h2 id="hero-title" class="hero-title">Join or Create a Movie Party</h2>
            <p class="hero-description">
              Watch movies together with friends! Create a room to host, or join an existing room with a code.
            </p>
          </section>

          <section class="action-section" aria-label="Room Actions">
            <div class="action-container">
              <div class="action-card create-room-card">
                <div class="card-icon">🏠</div>
                <h3>Create Room</h3>
                <p>Start a new movie party and invite friends to join</p>
                <button 
                  id="create-room-btn" 
                  class="btn btn-primary btn-large"
                  aria-describedby="create-room-help"
                >
                  Create New Room
                </button>
                <small id="create-room-help" class="help-text">
                  You'll be the host and control movie playback
                </small>
              </div>

              <div class="action-card join-room-card">
                <div class="card-icon">🚪</div>
                <h3>Join Room</h3>
                <p>Enter a room code to join an existing movie party</p>
                <button 
                  id="join-room-btn" 
                  class="btn btn-secondary btn-large"
                  aria-describedby="join-room-help"
                >
                  Join Existing Room
                </button>
                <small id="join-room-help" class="help-text">
                  Get the room code from your host
                </small>
              </div>
            </div>
          </section>

          <section class="features-section" aria-labelledby="features-title">
            <h3 id="features-title" class="features-title">What You Can Do</h3>
            <div class="features-grid">
              <div class="feature-item">
                <span class="feature-icon">🎬</span>
                <h4>Watch Together</h4>
                <p>Stream movies from your device with perfect sync</p>
              </div>
              <div class="feature-item">
                <span class="feature-icon">🎤</span>
                <h4>Voice Chat</h4>
                <p>Talk with friends during the movie</p>
              </div>
              <div class="feature-item">
                <span class="feature-icon">💬</span>
                <h4>Text Chat</h4>
                <p>Send messages without interrupting</p>
              </div>
              <div class="feature-item">
                <span class="feature-icon">📱</span>
                <h4>Mobile Ready</h4>
                <p>Works perfectly on any device</p>
              </div>
            </div>
          </section>

          
        </main>

        <footer role="contentinfo" class="main-footer">
          <p>&copy; 2025 BeeMoo - Movie Party Meetings Platform</p>
        </footer>
      </div>
    `}connectToServer(){this.socketClient.connect()}setupEventListeners(){const e=document.getElementById("create-room-btn"),t=document.getElementById("join-room-btn");e&&e.addEventListener("click",()=>this.handleCreateRoom()),t&&t.addEventListener("click",()=>this.handleJoinRoom());const s=document.getElementById("nav-toggle"),i=document.querySelector(".main-header"),o=document.getElementById("main-nav");if(s&&i&&o){const r=()=>{i.classList.remove("nav-open"),s.setAttribute("aria-expanded","false")},a=()=>{i.classList.add("nav-open"),s.setAttribute("aria-expanded","true")},c=()=>{i.classList.contains("nav-open")?r():a()};s.addEventListener("click",d=>{d.preventDefault(),c()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&r()}),o.addEventListener("click",d=>{d.target.tagName==="A"&&r()})}setTimeout(()=>{this.socketClient.isConnected&&(console.log("🏓 Testing WebSocket connection..."),this.socketClient.emit("ping",{message:"Hello from BeeMoo client!"}))},2e3)}handleCreateRoom(){console.log("🏠 Create room clicked"),this.roomCreation.show()}handleJoinRoom(){console.log("🚪 Join room clicked"),this.roomJoining.show()}handleRoomCreated(e){console.log("🎉 Room created successfully:",e),this.currentRoom=e,this.navigateToRoom(e)}handleRoomJoined(e){console.log("🎉 Room joined successfully:",e),this.currentRoom=e,this.navigateToRoom(e)}navigateToRoom(e){if(this.currentView="room",this.appElement){this.appElement.innerHTML="";const t=document.createElement("div");this.appElement.appendChild(t);const s=Array.isArray(e.participants)&&e.participants.length>0?e.participants:e.user?[e.user]:[];this.roomView.mount(t,{roomCode:e.roomCode,room:e.room,user:e.user,participants:s})}}static getVersion(){return"1.0.0"}}document.addEventListener("DOMContentLoaded",()=>{console.log("🎬 BeeMoo - Movie Party Meetings Platform"),new kt().init()});
//# sourceMappingURL=main-oGfbFbso.js.map
